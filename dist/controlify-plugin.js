!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var a,r,c,d,u,g,e,t,l,s,o,f,i;a=Object.create,r=Object.defineProperty,c=Object.getOwnPropertyDescriptor,d=Object.getOwnPropertyNames,u=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty,l=(e=(e,t)=>function(){return t||(0,e[d(e)[0]])((t={exports:{}}).exports,t),t.exports})({"external-global-plugin:react-dom"(e,t){t.exports=Spicetify.ReactDOM}}),s=(t=(e,t,l)=>{l=null!=e?a(u(e)):{};var o=!t&&e&&e.__esModule?l:r(l,"default",{value:e,enumerable:!0}),i=e,n=void 0,s=void 0;if(i&&"object"==typeof i||"function"==typeof i)for(let e of d(i))g.call(o,e)||e===n||r(o,e,{get:()=>i[e],enumerable:!(s=c(i,e))||s.enumerable});return o})(e({"external-global-plugin:react"(e,t){t.exports=Spicetify.React}})()),o=t(l()),f=class{constructor(e,t,l={}){this.name=e,this.settingsId=t,this.initialSettingsFields=l,this.settingsFields=this.initialSettingsFields,this.setRerender=null,this.pushSettings=async()=>{for(Object.entries(this.settingsFields).forEach(([e,t])=>{"button"!==t.type&&void 0===this.getFieldValue(e)&&this.setFieldValue(e,t.defaultValue)});!Spicetify?.Platform?.History?.listen;)await new Promise(e=>setTimeout(e,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(e=>{"/preferences"===e.pathname&&this.render()}),"/preferences"===Spicetify.Platform.History.location.pathname&&await this.render()},this.rerender=()=>{this.setRerender&&this.setRerender(Math.random())},this.render=async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if("/preferences"!==Spicetify.Platform.History.location.pathname)return;await new Promise(e=>setTimeout(e,100))}var e=document.querySelector(".main-view-container__scroll-node-child main div");if(!e)return console.error("[spcr-settings] settings container not found");let t=Array.from(e.children).find(e=>e.id===this.settingsId);t?console.log(t):((t=document.createElement("div")).id=this.settingsId,e.appendChild(t)),o.default.render(s.default.createElement(this.FieldsContainer,null),t)},this.addButton=(e,t,l,o,i)=>{this.settingsFields[e]={type:"button",description:t,value:l,events:{onClick:o,...i}}},this.addInput=(e,t,l,o,i,n)=>{this.settingsFields[e]={type:"input",description:t,defaultValue:l,inputType:i,events:{onChange:o,...n}}},this.addHidden=(e,t)=>{this.settingsFields[e]={type:"hidden",defaultValue:t}},this.addToggle=(e,t,l,o,i)=>{this.settingsFields[e]={type:"toggle",description:t,defaultValue:l,events:{onChange:o,...i}}},this.addDropDown=(e,t,l,o,i,n)=>{this.settingsFields[e]={type:"dropdown",description:t,defaultValue:l[o],options:l,events:{onSelect:i,...n}}},this.getFieldValue=e=>JSON.parse(Spicetify.LocalStorage.get(this.settingsId+"."+e)||"{}")?.value,this.setFieldValue=(e,t)=>{Spicetify.LocalStorage.set(this.settingsId+"."+e,JSON.stringify({value:t}))},this.FieldsContainer=()=>{var[e,t]=(0,s.useState)(0);return this.setRerender=t,s.default.createElement("div",{className:"x-settings-section",key:e},s.default.createElement("h2",{className:"TypeElement-cello-textBase-type"},this.name),Object.entries(this.settingsFields).map(([e,t])=>s.default.createElement(this.Field,{nameId:e,field:t})))},this.Field=l=>{var e=this.settingsId+"."+l.nameId;let t;if(t="button"===l.field.type?l.field.value:this.getFieldValue(l.nameId),"hidden"===l.field.type)return s.default.createElement(s.default.Fragment,null);const[o,i]=(0,s.useState)(t),n=e=>{void 0!==e&&(i(e),this.setFieldValue(l.nameId,e))};return s.default.createElement("div",{className:"x-settings-row"},s.default.createElement("div",{className:"x-settings-firstColumn"},s.default.createElement("label",{className:"TypeElement-viola-textSubdued-type",htmlFor:e},l.field.description||"")),s.default.createElement("div",{className:"x-settings-secondColumn"},"input"===l.field.type?s.default.createElement("input",{className:"x-settings-input",id:e,dir:"ltr",value:o,type:l.field.inputType||"text",...l.field.events,onChange:e=>{n(e.currentTarget.value);var t=l.field.events?.onChange;t&&t(e)}}):"button"===l.field.type?s.default.createElement("span",null,s.default.createElement("button",{id:e,className:"Button-sc-y0gtbx-0 Button-small-buttonSecondary-useBrowserDefaultFocusStyle x-settings-button",...l.field.events,onClick:e=>{n();var t=l.field.events?.onClick;t&&t(e)},type:"button"},o)):"toggle"===l.field.type?s.default.createElement("label",{className:"x-settings-secondColumn x-toggle-wrapper"},s.default.createElement("input",{id:e,className:"x-toggle-input",type:"checkbox",checked:o,...l.field.events,onClick:e=>{n(e.currentTarget.checked);var t=l.field.events?.onClick;t&&t(e)}}),s.default.createElement("span",{className:"x-toggle-indicatorWrapper"},s.default.createElement("span",{className:"x-toggle-indicator"}))):"dropdown"===l.field.type?s.default.createElement("select",{className:"main-dropDown-dropDown",id:e,...l.field.events,onChange:e=>{n(l.field.options[e.currentTarget.selectedIndex]);var t=l.field.events?.onChange;t&&t(e)}},l.field.options.map((e,t)=>s.default.createElement("option",{selected:e===o,value:t+1},e))):s.default.createElement(s.default.Fragment,null)))}}},i=async function(){for(;null==Spicetify||!Spicetify.showNotification;)await new Promise(e=>setTimeout(e,100));var o=0;const i=new f("Controlify settings","controlify-integration");let n=null,e=null;function s(){e&&clearTimeout(e),e=window.setTimeout(()=>{console.error("Did not receive heartbeat in time, closing connection"),n&&(n.close(),n=null,a())},15e3)}function a(){const t=i.getFieldValue("controlify-retry-count"),l=1e3*i.getFieldValue("controlify-retry-timeout");(n=new WebSocket("ws://localhost:8999")).onopen=()=>{o=0,console.log("Connected to Controlify server!");var e=JSON.stringify({clientID:"spicetify-client"});null!=n&&n.send(e),s()},n.onmessage=e=>{if("heartbeat"===e.data)s();else{var t=JSON.parse(e.data),e=void 0!==(e=t).setVolume?"setVolume":void 0!==e.toggleHeart?"toggleHeart":void 0!==e.next?"next":void 0!==e.back?"back":void 0!==e.togglePlay?"togglePlay":void 0!==e.play?"play":void 0!==e.pause?"pause":void 0!==e.toggleMute?"toggleMute":void 0!==e.toggleRepeat?"toggleRepeat":void 0!==e.toggleShuffle?"toggleShuffle":void 0!==e.increaseVolume?"increaseVolume":void 0!==e.decreaseVolume?"decreaseVolume":"unknown";switch(e){case"setVolume":null!=t.setVolume&&(console.log("Setting volume to",t.setVolume),Spicetify.Player.setVolume(t.setVolume));break;case"toggleHeart":console.log("Toggling heart"),Spicetify.Player.toggleHeart();break;case"next":console.log("Skipping to next track"),Spicetify.Player.next();break;case"back":console.log("Skipping to previous track"),Spicetify.Player.back();break;case"togglePlay":console.log("Toggling play"),Spicetify.Player.togglePlay();break;case"play":console.log("Playing"),Spicetify.Player.play();break;case"pause":console.log("Pausing"),Spicetify.Player.pause();break;case"toggleMute":console.log("Toggling mute"),Spicetify.Player.toggleMute();break;case"toggleRepeat":console.log("Toggling repeat"),Spicetify.Player.toggleRepeat();break;case"toggleShuffle":console.log("Toggling shuffle"),Spicetify.Player.toggleShuffle();break;case"increaseVolume":console.log("Increasing volume"),Spicetify.Player.setVolume(Spicetify.Player.getVolume()+i.getFieldValue("controlify-volume-steps")/100);break;case"decreaseVolume":console.log("Decreasing volume"),Spicetify.Player.setVolume(Spicetify.Player.getVolume()-i.getFieldValue("controlify-volume-steps")/100);break;default:console.log("Unknown action")}}},n.onclose=e=>{e.wasClean&&(i.getFieldValue("controlify-enable")&&(o<t||0==t)?(o++,console.log("Controlify server connection closed, attempting to reconnect..."),console.log(`Retries: ${o}/`+(0==t?"∞":t)),console.log("Waiting ",l/1e3,"s"),setTimeout(a,l)):(console.log("Controlify server connection closed"),n=null))},n.onerror=e=>{i.getFieldValue("controlify-enable")&&(o<t||0==t)?(o++,console.log("Failed to connect to the Controlify server, retrying..."),console.log(`Retries: ${o}/`+(0==t?"∞":t)),console.log("Waiting ",l/1e3,"s"),setTimeout(a,l)):(console.log("Failed to connect to the Controlify server"),n=null)}}i.addToggle("controlify-enable","Enable Controlify integration with Spotify!",!1,()=>{var e=i.getFieldValue("controlify-enable");e?a():!e&&n&&(n.close(),console.log("WebSocket connection closed"),n=null)}),i.addInput("controlify-retry-count","Retry count(0 for infinite retries)","5",()=>{i.getFieldValue("controlify-enable")&&(o=0,a())},"number"),i.addInput("controlify-retry-timeout","Retry timeout (s)","30",()=>{},"number"),i.addInput("controlify-volume-steps","Set how much the volume changes with each adjustment (out of a 100)","2",()=>{},"number"),i.pushSettings(),!n&&i.getFieldValue("controlify-enable")&&a()},(async()=>{await i()})()}();